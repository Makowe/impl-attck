\documentclass[tches]{iacrtrans}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{lipsum}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{float}
\usepackage{subcaption}
\usepackage{xcolor}
\usepackage{caption}
\begin{document}

\title{Implementation Attacks on the Simon Block Cipher: \\ Correlation Power Analysis and Statistical Leakage Assessment}

\author{
    Nico Makowe \and
    Kandarp Lalit\and
    Majdi Maraqa}

\date{\today}
\institute{Hochschule Albstadt-Sigmaringen}

\maketitle

\begin{center}
\textit{Supervised by Prof. Dr. Bernhard Jungk} \\
\end{center}

\begin{abstract}
This paper investigates implementation-level vulnerabilities of the lightweight block cipher SIMON by means of power-based side-channel analysis. A software implementation on an embedded ARM Cortex-M4 target is analyzed, demonstrating that data-dependent power consumption enables practical key recovery using Correlation Power Analysis (CPA) with as few as 500 traces. To mitigate these vulnerabilities, a Boolean masking countermeasure is implemented and its impact on attack feasibility evaluated. Experimental results show that masking increases the required traces for successful key recovery beyond 50,000, significantly reducing but not eliminating leakage. Welch's t-test is further employed for statistical leakage assessment, revealing strong data-dependent leakage (t-values up to 72.66) in unprotected implementations, while masked versions require substantially more traces for detectable leakage. These findings emphasize the importance of careful countermeasure design in lightweight cryptographic implementations.

\keywords{lightweight cryptography, side-channel analysis, correlation power analysis, SIMON, masking, implementation security, ChipWhisperer}
\end{abstract}

\section{Introduction}
Lightweight cryptography plays a crucial role in securing resource-constrained devices in the Internet of Things (IoT), where limitations in memory, power consumption, and computational capabilities must be carefully considered. The SIMON block cipher, introduced by the National Security Agency in 2013, is a family of lightweight block ciphers designed to achieve high performance in hardware while remaining efficient in software implementations.

SIMON, like many cryptographic algorithms, is susceptible to implementation-level attacks. In particular, side-channel attacks exploit physical leakage such as power consumption or electromagnetic radiation to recover secret information without breaking the underlying cryptographic primitive.

This paper investigates Correlation Power Analysis (CPA) applied to a software implementation of SIMON. Furthermore, the masking countermeasure is analyzed and its effectiveness in increasing resistance against power-based attacks is evaluated. The presented work follows a systematic attack-and-evaluation methodology commonly used in the analysis of cryptographic implementations.

\subsection{Background}
\subsubsection{The Simon Block Cipher}
Simon is a family of lightweight block ciphers based on a Feistel structure. The cipher supports multiple configurations with block sizes of 32, 48, 64, 96, and 128 bits, and key sizes ranging from 64 to 256 bits. Unlike some cipher families, Simon's key size does not always correspond directly to its block size; the cipher supports various combinations.

This study focuses on \textbf{Simon-64/128}, which operates on 64-bit blocks using a 128-bit key over \textbf{44 rounds}. The cipher is designed for optimal performance in both hardware and software implementations, featuring only bitwise XOR, AND, and rotation operations.

The round function for Simon-64/128 is defined as:
\[
R_k(x, y) = (y \oplus f(x) \oplus k, x)
\]
where 
\[
f(x) = (S^1(x) \& S^8(x)) \oplus S^2(x)
\]
Here, \(S^j\) denotes left circular shift by \(j\) bits, \(\oplus\) represents bitwise XOR, \(\&\) denotes bitwise AND, and \(k\) is the round key derived from the master key through a key schedule.

\begin{figure}[ht]
    \centering
    \begin{tikzpicture}[
        line width=0.6pt,
        box/.style = {draw},
        loosewire/.style = {looseness=0.5},
        xor/.style = {
            draw, circle, inner sep=0cm, minimum size=0.4cm,
            append after command = {
                [shorten >=0.5\pgflinewidth, shorten <=0.5\pgflinewidth]
                (\tikzlastnode.north) edge (\tikzlastnode.south)
                (\tikzlastnode.east) edge (\tikzlastnode.west)
            }
        },
        odot/.style = {draw, circle, inner sep=0cm, minimum size=0.4cm},
        dot/.style = {fill, circle, inner sep=0cm, minimum size=0.08cm},
        invisible/.style = {minimum size=0cm}
    ]
    
    % Draw nodes
    \node at (1,7) (xin) {$x_i$};
    \node at (5,7) (yin) {$y_i$};
    \node[dot] at (1,6) (d1) {};
    \node[dot] at (1,5) (d2) {};
    \node[dot] at (1,4) (d3) {};
    \node[box] at (2,6) (S1) {$<<<_1$};
    \node[box] at (2,5) (S2) {$<<<_8$};
    \node[box] at (2,4) (S3) {$<<<_2$};
    \node[xor] at (5,5.5) (x1) {};
    \node[xor] at (5,4) (x2) {};
    \node[xor] at (5,3) (x3) {};
    \node[odot] at (4,5.5) (AND) {$\&$};
    \node at (6,3) (k) {$k_i$};
    \node at (1,1) (xout) {$x_{i+1}$};
    \node at (5,1) (yout) {$y_{i+1}$};
    \coordinate (cright) at (5,2.5);
    \coordinate (cleft) at (1,2.5);
    
    % Draw wires
    \draw[->] (d1) -- (S1);
    \draw[loosewire,->] (S1.east) to[out=0, in=160] (AND);
    \draw[->] (d2) -- (S2);
    \draw[loosewire,->] (S2.east) to[out=0, in=200] (AND);
    \draw[->] (AND) -- (x1);
    \draw[->] (d3) -- (S3);
    \draw[->] (S3.east) -- (x2);
    \draw[loosewire,->] (xin) -- (d1) -- (d2) -- (d3)
        -- (cleft) to[out=270, in=90] (yout.north);
    \draw[->] (yin) -- (x1);
    \draw[->] (x1) -- (x2);
    \draw[->] (x2) -- (x3);
    \draw[loosewire,->] (x3) -- (cright) to[out=270, in=90] (xout.north);
    \draw[->] (k.west) -- (x3);
    \end{tikzpicture}
    \caption{One round of the Simon block cipher.}
    \label{fig:simon_round}
\end{figure}

The key schedule for Simon-64/128 generates \textbf{44 round keys} \(k_0, \ldots, k_{43}\) from the 128-bit master key using a linear recurrence relation. Intermediate states of particular interest for side-channel analysis include:
\begin{itemize}
    \item The output of the \(f(x)\) function in the first round, which depends directly on the plaintext and the first round key
    \item The XOR operations between round keys and the data state, especially in early rounds
    \item The AND operation within \(f(x)\), which introduces nonlinearity and may exhibit distinct power consumption patterns
    \item Intermediate states after each round, particularly during the first few rounds where key dependency is most exploitable
\end{itemize}

These intermediate states are vulnerable to side-channel attacks due to their direct dependency on both plaintext and key material, making them ideal targets for correlation analysis.

\subsubsection{Side-Channel Attacks}
Side-channel attacks exploit physical leakage from a device during cryptographic operations. Correlation Power Analysis (CPA) is a powerful statistical attack that correlates hypothetical power consumption models with measured power traces to recover secret keys.

The success of CPA depends on an accurate power model that approximates the device's actual power consumption. Common models include:
\begin{itemize}
    \item Hamming Weight (HW): Power consumption proportional to the number of 1s in a data word
    \item Hamming Distance (HD): Power consumption proportional to the number of bit changes between consecutive states
\end{itemize}

\section{Attack Methodology}
\subsection{Experimental Setup}

The experimental setup utilized a 32-bit ARM microcontroller running at \(120\ \mathrm{MHz}\). Simon-64/128 was implemented in C and compiled with the ARM GCC toolchain using optimization level -O2 to simulate realistic deployment conditions. Power traces were collected using the ChipWhisperer-Lite platform with a sampling rate of \(29.5\ \mathrm{MS/s}\) and 5,000 samples per trace.

For each measurement campaign, plaintexts were chosen randomly from a uniform distribution. Multiple independent measurement campaigns were conducted using different keys to validate the consistency of our results. The target operation for the attack was the output of the \(f(x)\) function in the first round, which depends on 32 bits of plaintext and 32 bits of the first round key. Due to the 32-bit architecture of the ARM microcontroller, the attack focused on 32-bit key chunks, aligning with the processor's native word size for optimal attack efficiency.

\subsection{Correlation Power Analysis (CPA)}
A CPA attack was performed on the first four rounds of Simon-64/128. The attack point chosen was the final state of the left half (X) after each round, which depends on both plaintext and round key material. This intermediate value provides a direct relationship between the key hypotheses and the power consumption, making it suitable for correlation analysis.

\subsubsection{Power Model}
The Hamming weight model was employed for the power analysis, which assumes that the power consumption of a digital circuit is proportional to the number of ones (or bits set to logic high) in the data being processed. This model is based on the observation that CMOS circuits consume power primarily during switching activities, and the number of bit transitions (from 0 to 1 or 1 to 0) correlates with the data values being manipulated.

For an \(n\)-bit intermediate value \(v\), the hypothetical power consumption is defined as:
\[
H(v) = \text{HW}(v) = \sum_{i=0}^{n-1} v[i]
\]
where \(v[i]\) denotes the \(i\)-th bit of \(v\), and HW denotes the Hamming weight function.

In the context of the Simon cipher, the target intermediate value for the first round is the output of the nonlinear function \(f\):
\[
v = f(L_0 \oplus k_0) = (S^1(L_0 \oplus k_0) \& S^8(L_0 \oplus k_0)) \oplus S^2(L_0 \oplus k_0)
\]
where \(L_0\) represents the left 32-bit half of the 64-bit plaintext, and \(k_0\) is the first 32-bit round key derived from the 128-bit master key.

The Hamming weight model is particularly suitable for the ARM microcontroller used in this study because the internal data paths of the ARM exhibit strong correlation between the Hamming weight of processed data and measured current draw, making it an effective approximation for power consumption during cryptographic operations.

An alternative model, the Hamming distance model, considers the number of bit changes between consecutive states. While this model is also applicable to the implementation and could potentially work, the Hamming weight model was selected for its simplicity and effectiveness in attacking the initial round operations.

The power consumption \(P(t)\) at time \(t\) can be modeled as:
\[
P(t) = \alpha \cdot H(v(t)) + \beta + N(t)
\]
where \(\alpha\) is a scaling factor representing the power contribution per bit, \(\beta\) is a constant offset representing baseline power consumption, and \(N(t)\) is Gaussian noise from various sources including measurement noise and unrelated circuit activities.

This model enables the correlation between hypothetical power values computed from known plaintexts and key candidates with the actual measured power traces, forming the basis of the Correlation Power Analysis attack.

\subsubsection{Attack Steps}
The CPA attack was executed according to the following procedure:
\begin{enumerate}
    \item Collect \(N\) power traces \(T_{i}\) with random plaintexts \(P_{i}\).
    \item For each key candidate \(k^{*}\) (\(0\) to \(255\) for each byte), compute the intermediate value \(v_{i}=f(P_{i}\oplus k^{*})\).
    \item Compute the hypothetical power values \(h_{i}=HW(v_{i})\).
    \item Compute the Pearson correlation coefficient \(\rho(T,h)\) between the traces and the hypothetical values.
    \item The key candidate with the highest absolute correlation is the correct key byte.
\end{enumerate}

\subsubsection{Simulation Validation}
Before conducting hardware attacks, the attack methodology was validated through simulation. Using a Python-based simulation of Simon-64/128 with a Hamming weight power model, the full 128-bit key was successfully recovered using only 1,000 simulated traces (Fig. \ref{fig:simulation_attack}). This confirmed the effectiveness of the attack model and parameter selection.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{a1.png}
    \caption{Power consumption graph for the unprotected Simon implementation showing distinct patterns corresponding to different Hamming weights.}
    \label{fig:power_graph_plain}
\end{figure}

\begin{figure}[H]
    \centering
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{3Measurmwents.png}
        \caption{Simulated power traces for three different plaintexts showing distinct Hamming weight patterns.}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{correlation_over_time_plain.png}
        \caption{Correlation Power Analysis (CPA) traces for the unprotected Simon implementation.}
    \end{subfigure}
    \caption{Simulation validation of CPA attack methodology. (a) Simulated power traces for three different plaintexts showing distinct Hamming weight patterns. (b) Correlation Power Analysis (CPA) traces for the unprotected Simon implementation.}
    \label{fig:simulation_attack}
\end{figure}

\subsubsection{Hardware Attack Results}
The attack successfully recovered the full 128-bit key from an unprotected implementation using 500 traces. Figure \ref{fig:cpa_correlation_traces} shows the correlation traces for the correct key byte and incorrect candidates. The correct candidate shows a distinct peak (absolute correlation \(>0.5\)) at the time instant where the targeted operation occurs.

\begin{figure}[H]
    \centering
    \includegraphics[width=1\linewidth]{CPA correlation traces for 256 key byte candidates.png}
    \caption{CPA correlation traces for 256 key byte candidates. The correct key byte (red) shows the highest correlation, while candidates with different Hamming distances from the correct value show varying correlation patterns.}
    \label{fig:cpa_correlation_traces}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{correlation_over_num_measurements_plain.png}
    \caption{Evolution of correlation values as the number of power traces increases in the CPA attack on unprotected Simon. The correlation converges to the correct key value as more traces are analyzed.}
    \label{fig:correlation_evolution_plain}
\end{figure}

\section{Countermeasures and Their Impact}
\subsection{Masking Implementation}
Boolean masking was implemented as a countermeasure against side-channel attacks. The sensitive intermediate state was split into two shares using random masks. All operations were performed on these shares, with the masks being refreshed between operations. The implementation maintained the original Simon algorithm's functionality while significantly increasing the noise in power measurements.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{power_graph_masked.png}
    \caption{Power consumption graph for the masked Simon implementation showing reduced data dependency compared to the unprotected version.}
    \label{fig:power_graph_masked}
\end{figure}

\subsection{Attack on Masked Implementation}
The CPA attack was repeated on the masked implementation using 50,000 traces. While the unmasked implementation revealed the full key within 500 traces, the masked version showed substantially reduced correlation peaks. As shown in Figs. \ref{fig:correlation_time_masked} and \ref{fig:correlation_evolution_masked}, the attack managed to narrow down key candidates but did not achieve full key recovery within the 50,000 trace limit, demonstrating the effectiveness of masking in increasing attack complexity.

\begin{figure}[H]
    \centering
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{Masked implementation.png}
        \caption{Masked implementation power traces showing increased noise.}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=\linewidth]{imulated masked traces.png}
        \caption{Mean power traces with standard deviation bands for two measurement sets.}
    \end{subfigure}
    \caption{Attack results on masked Simon implementation. (a) Power traces from the masked implementation showing increased noise. (b) Mean power traces with standard deviation bands demonstrating reduced data dependency.}
    \label{fig:masked_attack}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{correlation_over_time_masked.png}
    \caption{Masked: No key candidate stands out. Correlation over time for the masked Simon implementation showing significantly reduced correlation peaks.}
    \label{fig:correlation_time_masked}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{correlation_over_num_measurements_masked.png}
    \caption{Evolution of correlation values with increasing number of traces for the masked Simon implementation. The correlation converges much slower than for the unprotected version.}
    \label{fig:correlation_evolution_masked}
\end{figure}

\section{Statistical Leakage Assessment}
\subsection{Methodology}
Welch's t-test (Test Vector Leakage Assessment, TVLA) was employed to detect leakage in both unprotected and masked implementations. Three sets of traces were collected:
\begin{itemize}
    \item \textbf{Set 1:} Fixed key, fixed plaintext (reference set)
    \item \textbf{Set 2:} Fixed key, random plaintexts
    \item \textbf{Set 3:} Random keys, fixed plaintext
\end{itemize}

The t-statistic was computed for each time sample between Set 1 and Set 2 (to detect data dependency) and between Set 1 and Set 3 (to detect key dependency). A threshold of \(|t|>4.5\) indicates leakage with 99.999\% confidence.

\subsection{Results}
\begin{itemize}
    \item \textbf{Unprotected Simon:} Strong leakage was detected with t-values exceeding 72.66 at multiple time points (Fig. \ref{fig:leakage_plain}), confirming high vulnerability to CPA attacks.
    \item \textbf{Masked Simon:} The t-values remained below the threshold for up to 10,000 traces. However, with 50,000 traces, subtle leakage became detectable, though significantly reduced compared to the unprotected implementation (Fig. \ref{fig:leakage_masked}).
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{leakage_over_time_plain.png}
    \caption{Leakage assessment results for unprotected Simon implementation using Welch's t-test. Strong data-dependent leakage is visible with t-values exceeding 72.66.}
    \label{fig:leakage_plain}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{leakage_over_time_masked.png}
    \caption{Leakage assessment results for masked Simon implementation using Welch's t-test. Leakage is significantly reduced but still detectable with 50,000 traces.}
    \label{fig:leakage_masked}
\end{figure}

\section{Discussion}
Our results demonstrate a clear trade-off between security and performance in lightweight cryptography implementations. The unprotected Simon cipher proved highly vulnerable to CPA attacks, with full key recovery possible using only 500 traces. The Boolean masking countermeasure significantly increased the attack complexity, requiring more than two orders of magnitude additional traces for successful key recovery.

However, the masking implementation did not completely eliminate leakage, as evidenced by the TVLA results with large trace sets. This highlights several important considerations:
\begin{itemize}
    \item \textbf{Implementation quality:} The effectiveness of masking depends heavily on proper implementation, including secure random number generation and protection against higher-order attacks.
    \item \textbf{Trace requirements:} While masking increases the number of traces required for successful attacks, determined attackers with sufficient measurement capabilities may still succeed.
    \item \textbf{Performance overhead:} The masking implementation introduced approximately 40\% performance overhead, which may be acceptable for many IoT applications but could be prohibitive for extremely resource-constrained devices.
\end{itemize}

\section{Conclusion}
This study demonstrates that an unprotected software implementation of SIMON-64/128 is highly vulnerable to Correlation Power Analysis, enabling full key recovery with as few as 500 power traces. The application of Boolean masking as a countermeasure significantly increases the attack complexity, requiring over 50,000 traces while still showing detectable statistical leakage.

Our findings emphasize that while masking provides substantial protection against side-channel attacks, it does not offer absolute security and must be implemented carefully to avoid implementation flaws. Future work should investigate higher-order masking schemes and their practical applicability to resource-constrained IoT devices, as well as explore alternative countermeasures such as shuffling or dual-rail logic.

For practitioners implementing lightweight cryptography in IoT devices, we recommend:
\begin{itemize}
    \item Always implement side-channel countermeasures, even for algorithms designed for resource-constrained environments.
    \item Conduct thorough leakage assessment using statistical tests like TVLA during development.
    \item Consider the trade-offs between security, performance, and resource constraints when selecting countermeasures.
    \item Regularly update implementations as new attack techniques and countermeasures emerge.
\end{itemize}

\appendix
\section{Measurement Parameters}
\begin{table}[H]
\centering
\begin{tabular}{ll}
\toprule
\textbf{Parameter} & \textbf{Value} \\
\midrule
Microcontroller & STM32F303 (ARM Cortex-M4) \\
Clock frequency & 120 MHz \\
Sampling rate & 29.5 MS/s \\
Samples per trace & 5,000 \\
Number of traces (unmasked) & 500 \\
Number of traces (masked) & 50,000 \\
Correlation threshold & 0.001 \\
TVLA threshold & Â±4.5 \\
\bottomrule
\end{tabular}
\caption{Experimental measurement parameters}
\label{tab:params}
\end{table}

\begin{thebibliography}{99}
\bibitem{simon2013}
Beaulieu, R., Shors, D., Smith, J., Treatman-Clark, S., Weeks, B., \& Wingers, L. (2013). The SIMON and SPECK Families of Lightweight Block Ciphers. \textit{CRYPTOLOGY EPRINT ARCHIVE}.

\bibitem{cpa2004}
Brier, E., Clavier, C., \& Olivier, F. (2004). Correlation Power Analysis with a Leakage Model. \textit{International Workshop on Cryptographic Hardware and Embedded Systems}.

\bibitem{tvla2011}
Goodwill, G., Jun, B., Jaffe, J., \& Rohatgi, P. (2011). A testing methodology for side-channel resistance validation. \textit{NIST non-invasive attack testing workshop}.


\end{thebibliography}

\end{document}
